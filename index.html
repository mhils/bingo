<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Road Bingo</title>
  <link rel="manifest" href="manifest.json">
  <link href="bootstrap.min.css" rel="stylesheet">  
</head>
<body class="p-2 container">
  <h1 class="text-center my-4">Road Bingo</h1>
  <ul id="categories" class="list-group">
  </ul>
  <button id="create" class="btn btn-success btn-lg w-100 my-2">Create Game</button>
  <a id="continue" class="btn btn-primary btn-lg w-100 my-2 d-none" href="./play.html">Continue Game</a>
  <div class="text-center"><small>Version: 2022-09-02</small></div>
  <script>
    const $ = document.querySelector.bind(document);
    const categories = [
      {
        id: "license-plates-mn",
        label: "License Plates Minnesota",
        weight: 1,
        items: [
          {text: "🚘 Wisconsin"},
          {text: "🚘 N.&nbsp;Dakota"},
          {text: "🚘 S.&nbsp;Dakota"},
          {text: "🚘 Florida"},
          {text: "🚘 Illinois"},
          {text: "🚘 Iowa"},
          {text: "🚘 California"},
        ],
      },
      {
        id: "us-road-easy",
        label: "US Roads (easy)",
        weight: 1,
        items: [
          {text: "Any Bird"},
          {text: "🌯"},
          {text: "☕"},
          {text: "🍔"},
          {text: "🍦"},
          {text: "Mercedes Car"},
          {text: "BMW Car"},
          {text: "Toyota Car"},
          {text: "Ford Car"},
          {text: "🟨 Car"},
          {text: "🟥 Car"},
          {text: "🟩 Car"},
          {text: "Tank Truck"},
          {text: "RV"},
          {text: "🏍️"},
          {text: "Water Tower"},
          {text: "⛽"},
          {text: "🇺🇸 Flag"},
          {text: "👧"},
          {text: "👦"},
          {text: "🚾"},
        ]
      }, {
        id: "us-road-medium",
        label: "US Roads (medium)",
        weight: 1,
        items: [
          {text: "Non-US Flag"},
          {text: "Lake"},
          {text: "River"},
          {text: "🐕"},
          {text: "Road Works"},
          {text: "Stop Sign"},
          {text: "Yield Sign"},
          {text: "S-Curve Sign"},
          {text: "No Turn on Red"},
          {text: "No Parking"},
          {text: "No Trespassing"},
          {text: "Electric Billboard"},
          {text: "Paper Billboard"},
          {text: "Caution Animal Sign"},
          {text: "Adopt a Highway"},
          {text: "Speed Limit 65"},
          {text: "Speed Limit 60"},
          {text: "Speed Limit 55"},
          {text: "Speed Limit 40"},
          {text: "Speed Limit 25"},
          {text: "🚨 Flashing Light"},
          {text: "Porsche"},
          {text: "Tesla"},
          {text: "🚏"},
          {text: "🚲"},
          {text: "🚤"},
          {text: "🚓"},
          {text: "✈️"}, 
          {text: "Sport Field"},
          {text: "📡"},
          {text: "📫"},
          {text: "⛪"},
          {text: "🚯"},
          {text: "🚷"},
          {text: "🚸"},
          {text: "🧢"},
          {text: "🦺"},
          {text: "🚌"},
          {text: "Powerline"},
        ]
      }, {
        id: "us-road-hard",
        label: "US Roads (hard)",
        weight: 1,
        items: [
          {text: "🦆"},
          {text: "🐄"},
          {text: "🐎"},
          {text: "🐿️"},
          {text: "🌽"},
          {text: "🚜"},
          {text: "Amazon Truck"},
          {text: "UPS"},
          {text: "FedEx"},
          {text: "🚒"},
          {text: "🚑"},
          {text: "🚆"},
          {text: "Uber"},
          {text: "Windmill"},
          {text: "Silo"},
          {text: "Barn"},
          {text: "Storage Place"},
          {text: "Broken Car"},
          {text: "🪦"},
          {text: "🏦"},
          {text: "🏗️"},
          {text: "🏕️"},
          {text: "Medical Building"},
          {text: "🏭"},
          {text: "⛲"},
          {text: "🛝"},
        ]
      }
    ];
    $("#categories").innerHTML = categories.map(cat => `
      <li class="list-group-item">
      <input checked class="form-check-input me-1" type="checkbox" value="" id="${cat.id}">
      <label class="form-check-label" for="${cat.id}">${cat.label}</label>
    </li>`).join("");

    if ("gameState" in localStorage) {
      $("#continue").classList.remove("d-none");
    }

    const sample = (array) => {
      const random = Math.floor(Math.random() * array.length);
      return array[random];
    }

    $("#create").addEventListener("click", () => {
      let options = [];
      
      for (const cat of categories) {
        if(!$(`#${cat.id}`).checked)
          continue;

        for(let i=0; i < cat.weight; i++)
          options = options.concat(cat.items);
      }

      if ((new Set(options)).size < 25) {
        alert("Not enough entries.");
        return;
      }

      let items = [],
          seen = new Set([]);
      while(items.length < 24) {
        let item = sample(options);
        if(seen.has(item))
          continue;
        seen.add(item);
        items.push({checked: false, ...item});
      }

      items.splice(12, 0, {checked: true, text: "⭐"});
      
      localStorage["gameState"] = JSON.stringify(items);
      location.href = "./play.html";
    });

    if ('serviceWorker' in navigator) {
  	  navigator.serviceWorker.register('./sw.js');
  	}
  </script>
</body>
</html>